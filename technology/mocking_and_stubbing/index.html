<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Jacob Zivan Design"/><link rel="canonical" href="https://JacobZivanDesign.com/technology/mocking_and_stubbing"/><meta name="twitter:url" content="https://JacobZivanDesign.com/technology/mocking_and_stubbing"/><meta name="og:url" content="https://JacobZivanDesign.com/technology/mocking_and_stubbing"/><title>What's Mocking and Stubbing? | Jacob Zivan Design</title><meta name="twitter:title" content="What's Mocking and Stubbing? | Jacob Zivan Design"/><meta name="og:title" content="What's Mocking and Stubbing? | Jacob Zivan Design"/><meta name="description" content="What are Mocking and Stubbing and how do those concepts help write write cleaner, more effective unit tests in Swift. We'll explore Protocol Oriented Programming and hand-rolled mocks."/><meta name="twitter:description" content="What are Mocking and Stubbing and how do those concepts help write write cleaner, more effective unit tests in Swift. We'll explore Protocol Oriented Programming and hand-rolled mocks."/><meta name="og:description" content="What are Mocking and Stubbing and how do those concepts help write write cleaner, more effective unit tests in Swift. We'll explore Protocol Oriented Programming and hand-rolled mocks."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Jacob Zivan Design"/><meta name="twitter:image" content="https://JacobZivanDesign.com/images/social.jpg"/><meta name="og:image" content="https://JacobZivanDesign.com/images/social.jpg"/></head><body class="item-page"><!--ITEM HTML--><header><div class="wrapper"><a class="site-icon" href="/"><img src="/images/memoji.png" alt="Memoji of Jacob giving a thumbs up"/></a><nav><ul><li><a href="/musings">Musings</a></li><li><a class="selected" href="/technology">Technology</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>What's Mocking and Stubbing?</h1><p><em>And how do those concepts help write cleaner, more effective unit tests in Swift?</em></p><br/><p>Early on, I encountered the concepts of <strong>Stubbing</strong> and <strong>Mocking</strong> for the first time. I reacted to the discovery much like I did to testing in general. <em>"What's the point?"</em> I clearly didn't get it. In this article, we'll cover what mocks and stubs are, why they're used, and how they're used effectively.</p><br/><blockquote><p>What's the point?</p></blockquote><br/><h2>Are you Mocking me?</h2><p><strong>Mocking</strong> and <strong>Stubbing</strong> are used primarily for <strong>Unit Testing.</strong> But what are Mocks, or Stubs? And what is a "Unit" test? Yea... There's a lot of assumed knowledge here. Let's start by laying out some definitions and context:</p><br/><br/><br/><h3>Unit Testing</h3><br/><p>Unit testing is the act of writing tests where we run a small chunk of code in isolation, specifically, a single function. This "unit" should do exactly <code>A</code> under <code>X</code> conditions or exactly <code>B</code> under <code>Y</code> conditions etc., We control the variables and observe the outcomes at a very small scale.</p><p>Because unit tests target singular functions in the code base, we are able to verify how all the little pieces work in isolation. This gives us confidence that multiple units will integrate together without any surprises. And, what I like most about unit tests, when a test is written well, automated checks catch bugs <em>before</em> they ship to production.</p><p><em>A more specific description can be found on <a href="https://stackoverflow.com/a/1393/9333764">stack overflow</a>, among other places.</em> <a href="https://en.wikipedia.org/wiki/Pure_function">Pure Functions</a> are ideal for unit testing.</p><br/><br/><br/><h3>Mocks</h3><br/><p>Mocks are test doubles of an object that we place inside of our tests. They operate exactly as they are told to, and report back to you what happened in the test.</p><p>Mocks, when created, have the same interface as its target, but none of the functionality. Instead, the mock can be told to return stubbed data or to verify whether or not a mock's function was executed.</p><br/><br/><br/><h3>Stubs</h3><br/><p>Stubs are hardcoded responses that we can force into our test code that allow us to easily test a function fully, without having to configure the rest of the environment to achieve all of the possible outcomes.</p><p><em><a href="https://stackoverflow.com/a/463305/9333764">Here is a good summary</a> of mocking and stubbing if you'd like more info.</em></p><br/><br/><br/><h3>But Why?</h3><br/><p>There are 3 primary reasons I use mocking and stubbing. First, there is a significant reduction in the amount of boilerplate code required to configure each test. Second, we can prevent noisy or expensive tasks from occurring, like log outs or database reads and writes, by replacing those dependencies with mocks. Finally, we can automate tests that verify a code path was executed <em>this can not easily be done without the mock</em>. In short, Mocking and Stubbing allow us to focus on the code we're writing.</p><br/><br/><blockquote><p>Mocking and Stubbing allow us to focus on the code we're writing.</p></blockquote><br/><br/><h2>Writing Mocks and Stubs in Swift</h2><p>Swift is an awesome language. There's a lot to love about it, but, its implementation of <a href="https://en.wikipedia.org/wiki/Reflective_programming">reflection</a> is somewhat limited. Because of that, there used to be no good way to generate a mock and so, many developers have been manually creating them. Fortunately, Swift if is a <a href="https://bit.ly/3uJjpc8">Protocol Oriented Programming</a> Language, and we can account for this slight shortcoming.</p><br/><br/><h3>Hand Rolled Mocks</h3><br/><p>Much of the Swift community manually creates the mocks they need as they need them. To demonstrate how this is done, we'll make a simple example of a controller, a data store, and a logger using <a href="https://www.swiftbysundell.com/basics/protocols/">Protocols</a>. <em>Note the following example does not actually create a logger or store, only their interface.</em></p><p>This is what the implementation might look like:</p><br/><br/><pre><code><span class="keyword">protocol</span> Loggable {
    <span class="keyword">func</span> log(<span class="keyword">_</span> message: <span class="type">String</span>)
}

<span class="keyword">protocol</span> DataStore {
    <span class="keyword">func</span> getDataFor(<span class="keyword">_</span> user: <span class="type">User</span>) -&gt; <span class="type">Data</span>?
}

<span class="keyword">class</span> Controller {
    <span class="keyword">let</span> logger: <span class="type">Loggable</span>
    <span class="keyword">let</span> store: <span class="type">DataStore</span>
    <span class="keyword">let</span> user: <span class="type">User</span>
    <span class="keyword">var</span> data: <span class="type">Data</span>? = <span class="keyword">nil

    init</span>(<span class="keyword">_</span> logger: <span class="type">Loggable</span>, <span class="keyword">_</span> store: <span class="type">DataStore</span>, <span class="keyword">_</span> user: <span class="type">User</span>) {
        <span class="keyword">self</span>.<span class="property">logger</span> = logger
        <span class="keyword">self</span>.<span class="property">store</span> = store
        <span class="keyword">self</span>.<span class="property">user</span> = user
    }

    <span class="keyword">func</span> loadDataForUser() {
        data = store.<span class="call">getDataFor</span>(user)
        logger.<span class="call">log</span>(<span class="string">"data retrieved"</span>)
    }
}
</code></pre><br/><br/><p>The function <code>loadDataForUser</code> should read from a data store, log that it did so, and update the controller's <code>data</code> value. To test this code without actually logging an event or reading from our databases, we will need a mocked version of a logger and a data store. That might look something like this:</p><br/><br/><pre><code><span class="keyword">struct</span> MockLogger: <span class="type">Loggable</span> {
    <span class="keyword">var</span> wasCalled = <span class="keyword">false

    func</span> log(<span class="keyword">_</span> message: <span class="type">String</span>) {
        wasCalled = <span class="keyword">true</span>
    }
}

<span class="keyword">struct</span> MockStore: <span class="type">DataStore</span> {
    <span class="keyword">func</span> getDataFor(<span class="keyword">_</span> user: <span class="type">User</span>) -&gt; <span class="type">Data</span>? {
        <span class="string">""</span>.<span class="call">data</span>(using: .<span class="dotAccess">utf8</span>)
    }
}
</code></pre><br/><br/><p>These mocks will allow us to verify that <code>Controller.loadDataForUser</code> modifies the data variable, <strong>and</strong> that the logger gets called <em>(which is near impossible to do without a mock)</em>. We do this like so:</p><br/><br/><pre><code><span class="keyword">class</span> ControllerTests: <span class="type">XCTestCase</span> {
    <span class="keyword">func</span> testLoadDataForUser() {
        <span class="comment">// Given</span>
        <span class="keyword">let</span> logger = <span class="type">MockLogger</span>()
        <span class="keyword">let</span> controller = <span class="type">Controller</span>(logger, <span class="type">MockStore</span>(), <span class="type">User</span>(named: <span class="string">"Test"</span>))

        <span class="call">XCTAssertFalse</span>(logger.<span class="property">wasCalled</span>)
        <span class="call">XCTAssertNil</span>(controller.<span class="property">data</span>)
        
        <span class="comment">// When</span>
        controller.<span class="call">loadDataForUser</span>()
        
        <span class="comment">// Then</span>
        <span class="call">XCTAssertTrue</span>(logger.<span class="property">wasCalled</span>)
        <span class="call">XCTAssertNotNil</span>(controller.<span class="property">data</span>)
    }
}
</code></pre><br/><br/><p>In that example we mocked two interfaces and effectively tested the <code>Controller</code>. Because of the mocks, we were able to verify the functionality of the <code>Controller</code> without testing the functionality of the <code>DataStore</code> or the <code>Logger</code>. The actual implementations of those will get tested in isolation.</p><p>Now, you may have noticed that there was a bit of configuration code required to run those tests. And I told you that mocking <em>reduces</em> the amount of test configuration we need to write.</p><p>They do. Even hand rolled mocks like these do. But I prefer to have my mocks generated for me in such a way that eliminates the need to create one off mocks like this. Luckily, there is a package that will do just that. In my next article, you'll learn how to generate fully functional mocks using mockingbird ðŸ˜Š</p><h3><a href="../mockingbird"><code>-&gt; Auto-Magically generate mocks using Mockingbird -&gt;</code></a></h3><br/><br/></div><span>Tags: </span><ul class="tag-list"><li><a href="/tags/macos">MacOS</a></li><li><a href="/tags/ios">iOS</a></li><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/mocking">Mocking</a></li><li><a href="/tags/stubbing">Stubbing</a></li><li><a href="/tags/testing">Testing</a></li><li><a href="/tags/technology">Technology</a></li><li><a href="/tags/tutorial">Tutorial</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p class="jbmono">Code typeface == <a href="https://www.jetbrains.com/lp/mono/">JetBrains Mono</a></p><p><a href="/feed.rss">RSS feed</a></p><div class="social"><a target="_blank" class="find-me" href="https://github.com/JZDesign/"><img src="/images/git.svg"/></a><a target="_blank" class="find-me" href="https://www.linkedin.com/in/jacob-rakidzich-b8722436/"><img src="/images/linkedin.svg"/></a></div></footer></body></html>