<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Jacob Zivan Design"/><link rel="canonical" href="https://JacobZivanDesign.com/technology/mockingbird"/><meta name="twitter:url" content="https://JacobZivanDesign.com/technology/mockingbird"/><meta name="og:url" content="https://JacobZivanDesign.com/technology/mockingbird"/><title>Auto-Magically generate mocks using Mockingbird | Jacob Zivan Design</title><meta name="twitter:title" content="Auto-Magically generate mocks using Mockingbird | Jacob Zivan Design"/><meta name="og:title" content="Auto-Magically generate mocks using Mockingbird | Jacob Zivan Design"/><meta name="description" content="Now that you understand Mocking and Stubbing, I'll show you how to avoid writing hand-rolled mocks using Mockingbird; an amazing framework that makes unit testing a breeze."/><meta name="twitter:description" content="Now that you understand Mocking and Stubbing, I'll show you how to avoid writing hand-rolled mocks using Mockingbird; an amazing framework that makes unit testing a breeze."/><meta name="og:description" content="Now that you understand Mocking and Stubbing, I'll show you how to avoid writing hand-rolled mocks using Mockingbird; an amazing framework that makes unit testing a breeze."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Jacob Zivan Design"/><meta name="twitter:image" content="https://JacobZivanDesign.com/images/social.jpg"/><meta name="og:image" content="https://JacobZivanDesign.com/images/social.jpg"/></head><body class="item-page"><script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script><script>mermaid.initialize({ startOnLoad: true });</script><!--ITEM HTML--><header><div class="wrapper"><a class="site-icon" href="/"><img src="/images/memoji.png" alt="Memoji of Jacob giving a thumbs up"/></a><nav><ul><li><a class="selected" href="/technology">Technology</a></li><li><a href="/foresight">Foresight</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Auto-Magically generate mocks using Mockingbird</h1><br/><p>I personally use the <a href="https://github.com/birdrides/mockingbird">Mockingbird</a> framework to generate my mocks for me. I don't like having to mock an entire interface for every code path I want to test. <a href="https://github.com/birdrides/mockingbird">Mockingbird</a> affords me the convenience and versatility I've been looking for in the Swift world. It does have its limitations, but it's far better than doing all of that work by hand.</p><p><em>If you're not sure what mocking or stubbing is, check out <a href="../mocking_and_stubbing">this article.</a></em></p><br/><br/><h3>Installing Mockingbird</h3><br/><p>To get started, follow the <a href="https://github.com/birdrides/mockingbird">instructions</a> to install and use Mockingbird in your project. They support CocoaPods, Carthage, and Swift Package Manager (SPM). Please follow the instructions to the letter. This isn't a <em>"normal"</em> package. It is generating source code for your test suite on build. So you need to pay attention to the details.</p><p><em>I've done both Carthage and SPM in the past. I prefer the SPM route.</em></p><br/><br/><h3>Using Mockingbird</h3><br/><p>After you've installed Mockingbird in your project's test target, you're ready to rock! ðŸŽ¸ðŸŽ¸ Before we begin, there are several functions you should get to know in order to effectively use Mockingbird. There is a lot that Mockingbird is <a href="https://github.com/birdrides/mockingbird#usage">capable of</a>, but for this tutorial, we'll focus on the following:</p><br/><br/><h4>Creating a mock</h4><br/><p>Mockingbird has an awesome helper function, <code>mock()</code>, that handles most of this for us. It's used rather simply:</p><pre><code><span class="keyword">let</span> myMock = <span class="call">mock</span>(<span class="type">MyClass</span>.<span class="keyword">self</span>)
</code></pre><p>We want to assign the mock to a variable, in most cases, so that we can verify if a function it contains was, or will be, called.</p><br/><br/><h4>Stubbing the mock</h4><br/><p>Stubbing is handled with Mockinbird's <code>given</code> function. <code>given</code> will take a mock and one of its functions or variables and allow you to define the result of its invocation. This is handled with the <code>~&gt;</code> operator like so:</p><pre><code><span class="call">given</span>(myMock.<span class="call">someFunction</span>()) ~&gt; <span class="string">"You da man!"</span>
<span class="comment">// or to throw ðŸ¤¯</span>
<span class="call">given</span>(myMock.<span class="call">someFunction</span>()) ~&gt; { <span class="keyword">throw</span> <span class="type">SomeError</span>() }
</code></pre><br/><br/><br/><h4>Verifying the Mock</h4><br/><p>One of the most useful things about mocking, is verifying that a code path was executed. Mockingbird has a <code>verify</code> method that allows us to check if a function was called or not, or more specifically, exactly how many times it was called. It's pretty straight forward:</p><pre><code><span class="call">verify</span>(mock.<span class="call">someFunc</span>()).<span class="call">wasCalled</span>()
<span class="comment">// Or if the function should get triggered multiple times</span>
<span class="call">verify</span>(mock.<span class="call">someFunc</span>()).<span class="call">wasCalled</span>(<span class="call">exactly</span>(<span class="number">10</span>))
</code></pre><br/><br/><h4>Mocking Parameters and Return Values</h4><br/><p>Another incredibly useful feature of Mockingbird is the <code>any()</code> function. This little gizmo will inspect the type of the object it is supposed to fill, and create a mock of that type on the fly. It's incredibly handy if we need to test what happens if a dependency returns <code>nil</code> or not but we don't care about a specific value.</p><p>I use this a lot, especially for the harder to define values like the <code>Data</code> type:</p><pre><code><span class="call">given</span>(store.<span class="call">getDataForUser</span>(user: <span class="call">any</span>())) ~&gt; <span class="call">any</span>() <span class="comment">// Inline stubbing!!</span>
</code></pre><br/><br/><h2>Doing it, for real....</h2><br/><p>Let's recreate <a href="../mocking_and_stubbing">the example</a> from my last article, but for the tests we'll do things a little differently. Below is a controller that has a logger and a data store. There is a function that reads from the store and logs the event.</p><pre><code><span class="keyword">protocol</span> Loggable {
    <span class="keyword">func</span> log(<span class="keyword">_</span> message: <span class="type">String</span>)
}

<span class="keyword">protocol</span> DataStore {
    <span class="keyword">func</span> getDataFor(<span class="keyword">_</span> user: <span class="type">User</span>) -&gt; <span class="type">Data</span>?
}

<span class="keyword">class</span> Controller {
    <span class="keyword">let</span> logger: <span class="type">Loggable</span>
    <span class="keyword">let</span> store: <span class="type">DataStore</span>
    <span class="keyword">let</span> user: <span class="type">User</span>
    <span class="keyword">var</span> data: <span class="type">Data</span>? = <span class="keyword">nil

    init</span>(<span class="keyword">_</span> logger: <span class="type">Loggable</span>, <span class="keyword">_</span> store: <span class="type">DataStore</span>, <span class="keyword">_</span> user: <span class="type">User</span>) {
        <span class="keyword">self</span>.<span class="property">logger</span> = logger
        <span class="keyword">self</span>.<span class="property">store</span> = store
        <span class="keyword">self</span>.<span class="property">user</span> = user
    }

    <span class="keyword">func</span> loadDataForUser() {
        data = store.<span class="call">getDataFor</span>(user)
        logger.<span class="call">log</span>(<span class="string">"data retrieved"</span>)
    }
}
</code></pre><br/><p>What we'll do instead of hand writing the mocks is use the generated mocks provided to us by Mockingbird. The setup will look like this:</p><br/><pre><code><span class="keyword">class</span> ControllerTests: <span class="type">XCTestCase</span> {
    <span class="keyword">func</span> testLoadDataForUser() {
        <span class="keyword">let</span> logger = <span class="call">mock</span>(<span class="type">Logger</span>.<span class="keyword">self</span>)
        <span class="keyword">let</span> store = <span class="call">mock</span>(<span class="type">DataStore</span>.<span class="keyword">self</span>)
        <span class="keyword">let</span> user = <span class="type">User</span>(named: <span class="string">"Test"</span>)
        <span class="keyword">let</span> controller = <span class="type">Controller</span>(logger, store, user)
    }
}
</code></pre><br/><p>Then we can <strong>Stub</strong> the <strong>Mock</strong> <code>DataStore</code> like:</p><br/><pre><code><span class="call">given</span>(store.<span class="call">getDataForUser</span>(user: user)) ~&gt; <span class="call">any</span>()
</code></pre><br/><p>And finally we can invoke the controller function and run our assertions:</p><br/><pre><code>controller.<span class="call">loadDataForUser</span>()

<span class="call">verify</span>(logger.<span class="call">log</span>(<span class="call">any</span>())).<span class="call">wasCalled</span>()
<span class="call">XCTAssertNotNil</span>(controller.<span class="property">data</span>)
</code></pre><br/><br/><p>Instead of needing to write a mock for each use case we want to test, we can instead generate them on the fly, and stub their responses only when necessary. This reduces so much overhead when it comes to writing tests that it's tough to describe. I can't tell you how many lines of aggravating configuration code this tool has saved me this year alone.</p></div><span>Tags: </span><ul class="tag-list"><li><a href="/tags/macos">MacOS</a></li><li><a href="/tags/ios">iOS</a></li><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/mocking">Mocking</a></li><li><a href="/tags/stubbing">Stubbing</a></li><li><a href="/tags/testing">Testing</a></li><li><a href="/tags/technology">Technology</a></li><li><a href="/tags/tutorial">Tutorial</a></li></ul></article></div><footer><br/><div class="center">
    <p><sm>
    If you enjoy the content on my site and want to support my writing, you can donate <a href="https://ko-fi.com/jacobzivandesign" target="blank">here</a> or <a href="https://github.com/sponsors/JZDesign" target="blank">here.</a>
    </p></sm>
    <p><sm>
    Or if you're a <a href="https://wallet.proton.me" target="blank">Proton Wallet</a> user, you can send coin to donate@jacobzivandesign.com
    </p></sm>
</div><br/><br/><p class="jbmono">Code typeface == <a href="https://www.jetbrains.com/lp/mono/">JetBrains Mono</a></p><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p><div class="social"><a target="_blank" class="find-me" href="https://github.com/JZDesign/"><img src="/images/git.svg"/></a><a target="_blank" class="find-me" href="https://bsky.app/profile/jacobzivandesign.bsky.social"><img src="/images/bsky.svg"/></a><a target="_blank" class="find-me" href="https://x.com/JZivanDesign"><img src="/images/x-logo.svg"/></a><a target="_blank" class="find-me" href="https://mastodon.social/@jacobzivandesign"><img src="/images/mastodon.svg"/></a><a target="_blank" class="find-me" href="https://www.linkedin.com/in/jacob-rakidzich-b8722436/"><img src="/images/linkedin.svg"/></a></div><br/></footer></body></html>